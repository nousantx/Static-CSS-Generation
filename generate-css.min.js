#!/usr/bin/env node
let s=require("fs"),i=require("path"),r=require("node-html-parser")["parse"],t=require("glob"),a=require("commander")["Command"],n=require("chokidar");class o{constructor(e){this.validateConfig(e),this.config=e,this.generatedCSS=new Set}validateConfig(r){["input","output","property"].forEach(e=>{if(!r[e])throw new Error("Missing required configuration field: "+e)})}static toCamelCase(e){return e.replace(/-([a-z])/g,e=>e[1].toUpperCase())}static toKebabCase(e){return e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())}static escapeCSSSelector(e){return e.replace(/([ #.;?%&,@+*~'"!^$[\]()=>|])/g,"\\$1")}matchClass(e){return e.match(/(?:([a-zA-Z0-9-]+):)?(-?[a-zA-Z0-9_]+(?:-[a-zA-Z0-9_]+)*|\[--[a-zA-Z0-9_-]+\])-(-?(?:\d+(\.\d+)?)|(?:[a-zA-Z0-9_]+(?:-[a-zA-Z0-9_]+)*(?:-[a-zA-Z0-9_]+)*)|(?:#[0-9a-fA-F]+)|(?:\[[^\]]+\])|(?:\$[^\s]+))([a-zA-Z%]*)/)?.slice(1)||null}parseFile(r){try{var e=s.readFileSync(r,"utf-8"),t=i.extname(r),a={".html":this.parseHTML,".jsx":this.parseJSX,".tsx":this.parseJSX,".mdx":this.parseMDX}[t];return a?a.call(this,e):(console.warn("Unsupported file type: "+t),[])}catch(e){return console.error(`Error reading file ${r}:`,e),[]}}parseHTML(e){e=r(e);return this.extractClassNames(e)}parseJSX(e){var r,t=/className\s*=\s*{?["'`]([^"'`]+)["'`]?}?/g;let a=new Set;for(;null!==(r=t.exec(e));)r[1].split(/\s+/).forEach(e=>a.add(e));return Array.from(a)}parseMDX(e){return[...new Set([...this.parseHTML(e),...this.parseJSX(e)])]}extractClassNames(e){return Array.from(new Set(e.querySelectorAll("*").flatMap(e=>e.getAttribute("class")?.split(/\s+/)||[])))}parseClass(e){var r,t,a,[s,i]=e.split(":"),i=this.processCustomClass(i?s:void 0,i||s);return i?(this.generatedCSS.add(i),i):(s=this.matchClass(e))?([i,e,s,,r]=s,t=this.config.property[e],a=this.processFinalValue(s,r),(e=this.generateCSSRuleFromProperties(e,s+r,t,a,i))&&this.generatedCSS.add(e),e):null}processFinalValue(e,r){var t=this.config.values[e];return t||(e.startsWith("$")?`var(--${e.slice(1)})`:e.startsWith("[")&&e.endsWith("]")?(t=e.slice(1,-1).replace(/\\_/g," ")).startsWith("--")?`var(${t})`:t:e+(r||""))}generateCSSRuleFromProperties(e,t,a,s,i){var n;if(console.log(t,s),Array.isArray(a))return n=a.map(e=>o.toKebabCase(e)+": "+s).join("; "),this.generateCSSRule(e+"-"+t,n,null,i);if("object"!=typeof a||null===a)return e.startsWith("[--")&&e.endsWith("]")?(n=e.slice(1,-1).replace(/\\_/g," "),this.generateCSSRule(`[${n}]-`+t,n,s,i)):"string"==typeof a?this.generateCSSRule(e+"-"+t,o.toKebabCase(a),s,i):null;if(a.property&&a.value){let r=a.value.replace(/{value}/g,s);return Array.isArray(a.property)?(n=a.property.map(e=>o.toKebabCase(e)+": "+r).join("; "),this.generateCSSRule(e+"-"+t,n,null,i)):this.generateCSSRule(e+"-"+t,o.toKebabCase(a.property),r,i)}return this.generateCSSRule(e+"-"+t,a,s,i)}processCustomClass(e,a){var r=Object.entries(this.config.classes).filter(([,e])=>e.hasOwnProperty(a)).reduce((e,[r,t])=>(e[o.toKebabCase(r)]=t[a],e),{});return 0<Object.keys(r).length?(r=Object.entries(r).map(([e,r])=>e+": "+r).join("; "),this.generateCSSRule(a,r,null,e)):null}generateCSSRule(e,r,t,a){t=t?r+": "+t:r,r=o.escapeCSSSelector(e);return a?`.${a}\\:${r}:${a} { ${t}; }`:`.${r} { ${t}; }`}create(e){return(Array.isArray(e)?e:e.split(/\s+/)).forEach(e=>this.parseClass(e)),Array.from(this.generatedCSS).join("\n")}generateFromFiles(){let r=new Set;if(this.config.input){this.config.input.forEach(e=>{t.sync(e).forEach(e=>{this.parseFile(e).forEach(e=>r.add(e))})});var e=this.create(Array.from(r));try{s.writeFileSync(this.config.output,e),console.log("CSS file generated at: "+this.config.output)}catch(e){console.error(`Error writing CSS file ${this.config.output}:`,e)}return e}}}function e(){var e=new a,e=(e.version("1.0.0").description("Generate CSS from class names in your project files.").option("-w, --watch","Watch mode to regenerate CSS on file changes").option("-c, --config <path>","Path to the configuration file","tenoxui.config.js").parse(process.argv),e.opts()),r=i.resolve(process.cwd(),e.config),r=(s.existsSync(r)||(console.error(`Configuration file (${r}) not found.`),process.exit(1)),require(r));let t=new o(r);t.generateFromFiles(),e.watch&&n.watch(r.input,{ignoreInitial:!0}).on("all",()=>t.generateFromFiles())}require.main===module&&e(),module.exports=o;
//# sourceMappingURL=generate-css.min.js.map