#!/usr/bin/env node
let a=require("fs"),i=require("path"),r=require("node-html-parser")["parse"],t=require("glob"),s=require("commander")["Command"],n=require("chokidar");class GenerateCSS{constructor(e){this.t(e),this.i=e,this.o=new Set}t(r){["input","output","property"].forEach(e=>{if(!r[e])throw new Error("Missing required configuration field: "+e)})}static l(e){return e.replace(/-([a-z])/g,e=>e[1].toUpperCase())}static u(e){return e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())}static h(e){return e.replace(/([ #.;?%&,@+*~'"!^$[\]()=>|])/g,"\\$1")}S(e){return e.match(/(?:([a-zA-Z0-9-]+):)?(-?[a-zA-Z0-9_]+(?:-[a-zA-Z0-9_]+)*|\[--[a-zA-Z0-9_-]+\])-(-?(?:\d+(\.\d+)?)|(?:[a-zA-Z0-9_]+(?:-[a-zA-Z0-9_]+)*(?:-[a-zA-Z0-9_]+)*)|(?:#[0-9a-fA-F]+)|(?:\[[^\]]+\])|(?:\$[^\s]+))([a-zA-Z%]*)/)?.slice(1)||null}C(r){try{var e=a.readFileSync(r,"utf-8"),t=i.extname(r),s={g:this.p,m:this.A,$:this.A,v:this.G}[t];return s?s.call(this,e):(console.warn("Unsupported file type: "+t),[])}catch(e){return console.error(`Error reading file ${r}:`,e),[]}}p(e){e=r(e);return this.q(e)}A(e){var r,t=/className\s*=\s*{?["'`]([^"'`]+)["'`]?}?/g;let s=new Set;for(;null!==(r=t.exec(e));)r[1].split(/\s+/).forEach(e=>s.add(e));return Array.from(s)}G(e){return[...new Set([...this.p(e),...this.A(e)])]}q(e){return Array.from(new Set(e.querySelectorAll("*").flatMap(e=>e.getAttribute("class")?.split(/\s+/)||[])))}Z(e){var r,t,s,[a,i]=e.split(":"),i=this._(i?a:void 0,i||a);return i?(this.o.add(i),i):(a=this.S(e))?([i,e,a,,r]=a,t=this.i.property[e],s=this.j(a,r),(e=this.F(e,a+r,t,s,i))&&this.o.add(e),e):null}j(e,r){var t=this.i.values[e];return t||(e.startsWith("$")?`var(--${e.slice(1)})`:e.startsWith("[")&&e.endsWith("]")?(t=e.slice(1,-1).replace(/\\_/g," ")).startsWith("--")?`var(${t})`:t:e+(r||""))}F(e,t,s,a,i){var n;if(console.log(t,a),Array.isArray(s))return n=s.map(e=>GenerateCSS.u(e)+": "+a).join("; "),this.M(e+"-"+t,n,null,i);if("object"!=typeof s||null===s)return e.startsWith("[--")&&e.endsWith("]")?(n=e.slice(1,-1).replace(/\\_/g," "),this.M(`[${n}]-`+t,n,a,i)):"string"==typeof s?this.M(e+"-"+t,GenerateCSS.u(s),a,i):null;if(s.property&&s.value){let r=s.value.replace(/{value}/g,a);return Array.isArray(s.property)?(n=s.property.map(e=>GenerateCSS.u(e)+": "+r).join("; "),this.M(e+"-"+t,n,null,i)):this.M(e+"-"+t,GenerateCSS.u(s.property),r,i)}return this.M(e+"-"+t,s,a,i)}_(e,s){var r=Object.entries(this.i.classes).filter(([,e])=>e.hasOwnProperty(s)).reduce((e,[r,t])=>(e[GenerateCSS.u(r)]=t[s],e),{});return 0<Object.keys(r).length?(r=Object.entries(r).map(([e,r])=>e+": "+r).join("; "),this.M(s,r,null,e)):null}M(e,r,t,s){t=t?r+": "+t:r,r=GenerateCSS.h(e);return s?`.${s}\\:${r}:${s} { ${t}; }`:`.${r} { ${t}; }`}create(e){return(Array.isArray(e)?e:e.split(/\s+/)).forEach(e=>this.Z(e)),Array.from(this.o).join("\n")}O(){let r=new Set;if(this.i.input){this.i.input.forEach(e=>{t.sync(e).forEach(e=>{this.C(e).forEach(e=>r.add(e))})});var e=this.create(Array.from(r));try{a.writeFileSync(this.i.output,e),console.log("CSS file generated at: "+this.i.output)}catch(e){console.error(`Error writing CSS file ${this.i.output}:`,e)}return e}}}function main(){var e=new s,e=(e.version("1.0.0").description("Generate CSS from class names in your project files.").option("-w, --watch","Watch mode to regenerate CSS on file changes").option("-c, --config <path>","Path to the configuration file","tenoxui.config.js").parse(process.argv),e.opts()),r=i.resolve(process.cwd(),e.i),r=(a.existsSync(r)||(console.error(`Configuration file (${r}) not found.`),process.exit(1)),require(r));let t=new GenerateCSS(r);t.O(),e.watch&&n.watch(r.input,{N:!0}).on("all",()=>t.O())}require.main===module&&main(),module.exports=GenerateCSS;
//# sourceMappingURL=cli.min.js.map